{% extends "base.html" %}

{% block title %}{{ article.title }} - Infinite Wiki{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>{{ article.title }}</h2>
    <a href="/world/{{ world_name }}/wiki/{{ article.title }}/edit" class="button"
        style="font-size: 0.8em; padding: 5px 10px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px;">Edit</a>
</div>

{% if article.image_url %}
<div class="image-container">
    <img src="{{ article.image_url }}" alt="{{ article.image_caption }}">
    <p class="caption">{{ article.image_caption }}</p>
</div>
{% elif generate_images %}
<div class="image-container" id="image-placeholder">
    <div class="loading-image">
        <p>Generating Image...</p>
        <div class="spinner"></div>
    </div>
    <p class="caption">{{ article.image_caption }}</p>
</div>
<script>
    // Poll for image
    const checkImage = setInterval(() => {
        fetch(window.location.href)
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const img = doc.querySelector('.image-container img');
                if (img) {
                    document.querySelector('.image-container').innerHTML = doc.querySelector('.image-container').innerHTML;
                    clearInterval(checkImage);
                }
            });
    }, 3000);
</script>
{% endif %}

<div class="summary">
    <strong>Summary:</strong> {{ article.summary }}
</div>

<hr>

<div class="content">
    {{ content_html | safe }}
</div>

<div class="related">
    <h3>Related Entries</h3>
    <ul>
        {% for entity in related_entities %}
        <li>
            <a href="/world/{{ world_name }}/wiki/{{ entity.name }}" onclick="showLoading()">{{ entity.name }}</a>
            <span style="font-size: 0.8em; color: #666;">({{ entity.type }})</span>
        </li>
        {% endfor %}
    </ul>
</div>

<div id="loading-msg" class="loading">
    Generating content for the next entry... This might take a moment.
</div>
{% endblock %}